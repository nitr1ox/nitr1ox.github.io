<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OM ‚Äî Une Passion (3D)</title>
  <style>
    :root{
      --bg:#050914; --bg2:#070b1a;
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.72);
      --stroke:rgba(255,255,255,.14);
      --glass:rgba(255,255,255,.06);
      --glass2:rgba(255,255,255,.10);
      --blue:#00b3ff; --cyan:#2ee6ff; --gold:#ffcc66;
      --shadow: 0 18px 70px rgba(0,0,0,.58);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(0,179,255,.22), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(255,204,102,.12), transparent 60%),
        radial-gradient(1000px 700px at 70% 90%, rgba(46,230,255,.12), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }

    /* Stadium lights background */
    .lights{
      position:fixed; inset:0; pointer-events:none; z-index:-2;
      filter: blur(40px) saturate(125%);
      opacity:.68;
    }
    .lights::before,.lights::after{
      content:""; position:absolute; inset:-40px;
      background:
        conic-gradient(from 220deg at 50% 50%,
          rgba(0,179,255,0),
          rgba(0,179,255,.28),
          rgba(255,204,102,.18),
          rgba(46,230,255,.24),
          rgba(0,179,255,0));
      animation: spin 16s linear infinite;
    }
    .lights::after{
      animation-duration: 28s;
      opacity:.58;
      mix-blend-mode: screen;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    /* subtle grain */
    .grain{
      position:fixed; inset:0; pointer-events:none; z-index:-1;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      opacity:.07;
      mix-blend-mode: overlay;
    }

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(14px);
      background: rgba(5,9,20,.56);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .wrap{ width:min(1120px, 92vw); margin:0 auto; }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:14px 0;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      text-decoration:none; color:var(--text); user-select:none;
    }
    .logo{
      width:44px; height:44px; border-radius:16px;
      background: linear-gradient(135deg, rgba(0,179,255,.95), rgba(46,230,255,.55));
      box-shadow: 0 12px 28px rgba(0,179,255,.22);
      border:1px solid rgba(255,255,255,.16);
      position:relative;
      transform: translateZ(0);
    }
    .logo::after{
      content:""; position:absolute; inset:2px; border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.20), rgba(255,255,255,0));
    }
    .brand strong{ letter-spacing:.4px; }
    .brand small{ display:block; color:var(--muted); font-weight:600; margin-top:2px; }

    .links{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    .links a{
      color:var(--muted); text-decoration:none; font-weight:800;
      padding:10px 12px; border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
    }
    .links a:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.16);
      color: var(--text);
    }

    /* HERO */
    .hero{
      padding: 56px 0 18px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 26px;
      align-items:center;
    }
    @media (max-width: 900px){ .hero{ grid-template-columns: 1fr; padding-top: 44px; } }

    .kicker{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-weight:900; letter-spacing:.3px;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, var(--cyan));
      box-shadow: 0 0 18px rgba(46,230,255,.45);
    }

    /* 3D text */
    h1{
      margin:16px 0 10px;
      font-size: clamp(34px, 4vw, 58px);
      line-height: 1.02;
      letter-spacing: -0.6px;
      text-shadow:
        0 2px 0 rgba(0,0,0,.35),
        0 14px 40px rgba(0,0,0,.55);
    }
    .lead{
      margin:0 0 14px;
      color: var(--muted);
      font-size: clamp(16px, 1.35vw, 18px);
      line-height:1.65;
    }

    .ctaRow{ display:flex; gap:12px; flex-wrap:wrap; margin-top:16px; }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      text-decoration:none;
      font-weight:950;
      box-shadow: 0 12px 34px rgba(0,0,0,.25);
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      will-change: transform;
    }
    .btn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.20); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(0,179,255,.92), rgba(46,230,255,.45));
      border-color: rgba(46,230,255,.38);
    }
    .btn.primary:hover{ transform: translateY(-2px) scale(1.01); }
    .btn .icon{
      width:24px; height:24px; border-radius:10px;
      background: rgba(255,255,255,.18);
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.18);
    }

    .hr{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
      margin: 18px 0;
    }

    /* ===== Tilt / glow helpers ===== */
    .tiltStage{ perspective: 1100px; }
    .tilt{ transform-style: preserve-3d; will-change: transform; position:relative; }
    .glow{
      position:absolute; inset:-140px;
      background: radial-gradient(260px 200px at var(--mx,50%) var(--my,30%), rgba(46,230,255,.22), transparent 60%);
      opacity:0; transition: opacity .2s ease;
      pointer-events:none; mix-blend-mode: screen;
    }
    .tilt:hover .glow{ opacity:.95; }

    /* ===== Hero 3D panel (layered parallax) ===== */
    .panel{
      border-radius: 28px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: 420px;
      position:relative;
    }
    .layer{
      position:absolute; inset:0;
      transform-style: preserve-3d;
      will-change: transform;
    }
    .layer.bg{
      background:
        radial-gradient(700px 260px at 20% 18%, rgba(46,230,255,.16), transparent 60%),
        radial-gradient(700px 320px at 85% 30%, rgba(255,204,102,.12), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.45)),
        url("https://images.unsplash.com/photo-1521412644187-c49fa049e84d?auto=format&fit=crop&w=1600&q=80");
      background-size: cover;
      background-position: center;
      filter: contrast(1.05) saturate(1.06);
      transform: translateZ(-50px) scale(1.10);
    }
    .layer.mid{
      background:
        radial-gradient(300px 200px at 30% 65%, rgba(0,179,255,.18), transparent 60%),
        radial-gradient(260px 180px at 75% 25%, rgba(46,230,255,.18), transparent 60%);
      transform: translateZ(-10px);
      mix-blend-mode: screen;
      opacity:.9;
    }
    .layer.fg{
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
      gap:10px;
      padding:20px;
      transform: translateZ(40px);
    }
    .badgeRow{ display:flex; gap:8px; flex-wrap:wrap; }
    .badge{
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(5,9,20,.46);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.86);
      font-weight:950;
      font-size: 12px;
      letter-spacing:.4px;
      text-transform: uppercase;
    }
    .panelTitle{
      margin:0;
      font-size: 22px;
      font-weight: 1000;
      text-shadow: 0 16px 44px rgba(0,0,0,.65);
    }
    .panelText{
      margin:0;
      color: rgba(255,255,255,.78);
      line-height:1.55;
      max-width: 50ch;
      text-shadow: 0 16px 44px rgba(0,0,0,.65);
    }

    section{ padding: 26px 0; }
    .sectionTitle{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:16px; margin: 8px 0 14px;
    }
    .sectionTitle h2{ margin:0; font-size: 22px; letter-spacing:.2px; }
    .sectionTitle p{ margin:0; color: var(--muted); max-width: 62ch; }

    /* ===== 3D Carousel Cylinder ===== */
    .carouselWrap{
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      padding: 18px;
      overflow:hidden;
      position:relative;
    }
    .carouselHeader{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom: 12px;
    }
    .carouselHeader .hint{
      color: var(--muted);
      font-weight:800;
      font-size: 13px;
    }

    .carousel3d{
      height: 420px;
      perspective: 1400px;
      position:relative;
      user-select:none;
      touch-action: pan-y;
    }
    @media (max-width: 640px){ .carousel3d{ height: 380px; } }

    .scene{
      position:absolute; inset:0;
      display:grid; place-items:center;
    }
    .ring{
      position:relative;
      width: min(740px, 92vw);
      height: 360px;
      transform-style: preserve-3d;
      will-change: transform;
    }
    @media (max-width: 640px){ .ring{ height: 320px; } }

    .card3d{
      position:absolute;
      left:50%; top:50%;
      width: min(520px, 78vw);
      height: 290px;
      transform-style: preserve-3d;
      transform: translate(-50%,-50%);
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
    }
    .card3d::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.58));
      pointer-events:none;
    }
    .img3d{
      position:absolute; inset:0;
      background-size: cover;
      background-position:center;
      transform: translateZ(-30px) scale(1.08);
      filter: saturate(1.06) contrast(1.04);
    }
    .cap3d{
      position:absolute;
      left:16px; right:16px; bottom:14px;
      transform: translateZ(40px);
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
    }
    .cap3d strong{
      font-size: 16px;
      letter-spacing:.2px;
      text-shadow: 0 16px 44px rgba(0,0,0,.7);
    }
    .pill{
      padding:8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(5,9,20,.46);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.86);
      font-weight: 1000;
      font-size: 12px;
      letter-spacing: .3px;
      white-space: nowrap;
    }

    .controls{
      display:flex; flex-wrap:wrap;
      gap:10px; align-items:center; justify-content:flex-end;
      margin-top: 12px;
    }
    .ctrlBtn{
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 1000;
      cursor:pointer;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
    }
    .ctrlBtn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.20); }
    .toggle{
      display:flex; gap:8px; align-items:center;
      color: var(--muted); font-weight:900; font-size: 13px;
      padding:10px 12px; border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .toggle input{ accent-color: var(--cyan); }

    /* ===== mini cards section ===== */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .mini{
      grid-column: span 4;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      box-shadow: 0 14px 44px rgba(0,0,0,.35);
      overflow:hidden;
      position:relative;
      transform-style: preserve-3d;
      will-change: transform;
      min-height: 220px;
    }
    @media (max-width: 980px){ .mini{ grid-column: span 6; } }
    @media (max-width: 640px){ .mini{ grid-column: span 12; } }
    .mini .mimg{
      height: 140px;
      background-size: cover;
      background-position:center;
      transform: translateZ(-18px) scale(1.06);
      filter: saturate(1.05) contrast(1.02);
    }
    .mini .mbody{
      padding: 12px 14px 14px;
      transform: translateZ(18px);
    }
    .mini h3{ margin:0 0 6px; font-size: 16px; letter-spacing:.2px; }
    .mini p{ margin:0; color: var(--muted); line-height:1.55; font-size: 14px; }

    /* Reveal */
    .reveal{
      opacity:0;
      transform: translateY(14px);
      transition: opacity .65s ease, transform .65s ease;
    }
    .reveal.visible{ opacity:1; transform: translateY(0); }

    footer{ padding: 30px 0 44px; color: rgba(255,255,255,.62); text-align:center; }
  </style>
</head>
<body>
  <div class="lights"></div>
  <div class="grain"></div>

  <header>
    <div class="wrap nav">
      <a class="brand" href="#top">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <strong>OM ‚Äî Une Passion</strong>
          <small>Bleu & Blanc ‚Ä¢ Ferveur ‚Ä¢ V√©lodrome</small>
        </div>
      </a>
      <nav class="links">
        <a href="#top">Accueil</a>
        <a href="#carrousel">Carrousel 3D</a>
        <a href="#plus">Plus</a>
      </nav>
    </div>
  </header>

  <main id="top" class="wrap">
    <section class="hero">
      <div class="reveal">
        <div class="kicker"><span class="dot"></span> Ici, l‚ÄôOM n‚Äôest pas un club : c‚Äôest une √©motion.</div>
        <h1>OM : une passion en relief.</h1>
        <p class="lead">
          Survole, fais glisser, joue avec la profondeur : ce site bouge comme un soir de match.
          Le carrousel est un vrai cylindre 3D (rotation + perspective).
        </p>
        <div class="ctaRow">
          <a class="btn primary" href="#carrousel"><span class="icon">üåÄ</span> Voir le carrousel 3D</a>
          <a class="btn" href="#plus"><span class="icon">‚ú®</span> Voir les effets</a>
        </div>
        <div class="hr"></div>
        <p style="margin:0;color:var(--muted);font-weight:800">
          Astuce : molette = tourne le carrousel. Sur mobile : swipe.
        </p>
      </div>

      <div class="tiltStage reveal" style="transition-delay:.12s">
        <article class="panel tilt" data-tilt>
          <div class="glow" aria-hidden="true"></div>
          <div class="layer bg" aria-hidden="true"></div>
          <div class="layer mid" aria-hidden="true"></div>
          <div class="layer fg">
            <div class="badgeRow">
              <span class="badge">Ferveur</span>
              <span class="badge">Bleu & Blanc</span>
              <span class="badge">V√©lodrome</span>
            </div>
            <h3 class="panelTitle">Le V√©lodrome : un rugissement.</h3>
            <p class="panelText">Quand la tribune s‚Äôallume, la ville vibre. L‚ÄôOM, c‚Äôest plus grand que 90 minutes.</p>
          </div>
        </article>
      </div>
    </section>

    <section id="carrousel" class="reveal">
      <div class="sectionTitle">
        <h2>Carrousel 3D ‚ÄúCylindre‚Äù</h2>
        <p>Rotation autour d‚Äôun axe + profondeur. Drag / swipe / molette + autoplay + inertie.</p>
      </div>

      <div class="carouselWrap tilt" data-tilt>
        <div class="glow" aria-hidden="true"></div>

        <div class="carouselHeader">
          <div>
            <strong style="display:block;font-size:18px;letter-spacing:.2px">OM en 3D</strong>
            <span class="hint">Souris : drag ‚Ä¢ Mobile : swipe ‚Ä¢ Molette : rotation</span>
          </div>
          <span class="pill">üíô‚ö™ OM</span>
        </div>

        <div class="carousel3d" id="carousel3d">
          <div class="scene">
            <div class="ring" id="ring"></div>
          </div>
        </div>

        <div class="controls">
          <button class="ctrlBtn" id="prev">‚óÄ Pr√©c√©dent</button>
          <button class="ctrlBtn" id="next">Suivant ‚ñ∂</button>

          <label class="toggle">
            <input type="checkbox" id="autoplay" checked />
            Autoplay
          </label>

          <button class="ctrlBtn" id="random">üé≤ Al√©atoire</button>
        </div>
      </div>
    </section>

    <section id="plus" class="reveal">
      <div class="sectionTitle">
        <h2>Plus d‚Äôeffets</h2>
        <p>Cartes en tilt 3D + lumi√®re qui suit la souris.</p>
      </div>

      <div class="grid">
        <article class="mini tilt" data-tilt>
          <div class="glow" aria-hidden="true"></div>
          <div class="mimg" style="background-image:url('https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=1400&q=80')"></div>
          <div class="mbody">
            <h3>Ambiance</h3>
            <p>Le bruit, les drapeaux, les chants : une √©nergie qui te traverse.</p>
          </div>
        </article>

        <article class="mini tilt" data-tilt>
          <div class="glow" aria-hidden="true"></div>
          <div class="mimg" style="background-image:url('https://images.unsplash.com/photo-1508098682722-e99c643e7f2b?auto=format&fit=crop&w=1400&q=80')"></div>
          <div class="mbody">
            <h3>Frissons</h3>
            <p>Une seconde‚Ä¶ puis l‚Äôexplosion. Le c≈ìur va plus vite que le ballon.</p>
          </div>
        </article>

        <article class="mini tilt" data-tilt>
          <div class="glow" aria-hidden="true"></div>
          <div class="mimg" style="background-image:url('https://images.unsplash.com/photo-1483729558449-99ef09a8c325?auto=format&fit=crop&w=1400&q=80')"></div>
          <div class="mbody">
            <h3>Fid√©lit√©</h3>
            <p>Dans les hauts comme dans les bas : l‚ÄôOM reste. Toujours.</p>
          </div>
        </article>
      </div>
    </section>

    <footer class="reveal">
      <div class="hr"></div>
      <p>Site fan non officiel ‚Ä¢ Fait avec üíô‚ö™ ‚Ä¢ Images : Unsplash</p>
    </footer>
  </main>

  <script>
    // ===== Reveal on scroll =====
    const reveals = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('visible'); });
    }, { threshold: 0.12 });
    reveals.forEach(el => io.observe(el));

    // ===== Tilt + dynamic glow =====
    const tiltEls = document.querySelectorAll('[data-tilt]');
    tiltEls.forEach(el => {
      el.addEventListener('mousemove', (ev) => {
        const r = el.getBoundingClientRect();
        const x = ev.clientX - r.left;
        const y = ev.clientY - r.top;
        const px = x / r.width;
        const py = y / r.height;

        el.style.setProperty('--mx', (px*100).toFixed(2) + '%');
        el.style.setProperty('--my', (py*100).toFixed(2) + '%');

        const maxY = 12, maxX = 10;
        const rotY = (px - 0.5) * maxY;
        const rotX = (0.5 - py) * maxX;
        el.style.transform = `translateY(-4px) rotateX(${rotX.toFixed(2)}deg) rotateY(${rotY.toFixed(2)}deg)`;
      });
      el.addEventListener('mouseleave', () => {
        el.style.transform = 'translateY(0) rotateX(0) rotateY(0)';
        el.style.setProperty('--mx','50%');
        el.style.setProperty('--my','30%');
      });
    });

    // ===== TRUE 3D Cylinder Carousel =====
    const slides = [
      { title:"Le V√©lodrome qui gronde", tag:"Stade", url:"https://images.unsplash.com/photo-1521412644187-c49fa049e84d?auto=format&fit=crop&w=1600&q=80" },
      { title:"Marseille, la mer, la ville", tag:"Marseille", url:"https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1600&q=80" },
      { title:"Les soirs de match", tag:"Frissons", url:"https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=1600&q=80" },
      { title:"La ferveur en tribune", tag:"Chants", url:"https://images.unsplash.com/photo-1508098682722-e99c643e7f2b?auto=format&fit=crop&w=1600&q=80" },
      { title:"Bleu & blanc", tag:"Fiert√©", url:"https://images.unsplash.com/photo-1483729558449-99ef09a8c325?auto=format&fit=crop&w=1600&q=80" },
      { title:"Le collectif", tag:"√âquipe", url:"https://images.unsplash.com/photo-1552664730-d307ca884978?auto=format&fit=crop&w=1600&q=80" }
    ];

    const ring = document.getElementById('ring');
    const carousel = document.getElementById('carousel3d');

    const autoplayToggle = document.getElementById('autoplay');
    const btnPrev = document.getElementById('prev');
    const btnNext = document.getElementById('next');
    const btnRandom = document.getElementById('random');

    let angle = 0;               // current rotation angle (deg)
    let velocity = 0;            // inertia
    let isDown = false;
    let lastX = 0;
    let autoplayTimer = null;

    const N = slides.length;
    const step = 360 / N;

    function build(){
      ring.innerHTML = '';
      slides.forEach((s, i) => {
        const card = document.createElement('div');
        card.className = 'card3d tilt';
        card.setAttribute('data-tilt', ''); // reuse glow follow in this card too
        card.innerHTML = `
          <div class="img3d" style="background-image:url('${s.url}')"></div>
          <div class="glow" aria-hidden="true"></div>
          <div class="cap3d">
            <strong>${s.title}</strong>
            <span class="pill">${s.tag}</span>
          </div>
        `;
        ring.appendChild(card);

        // Place each card around cylinder
        const a = i * step;
        // radius depends on viewport for better 3D
        card.dataset.baseAngle = String(a);
      });
      layout();
    }

    function layout(){
      const cards = ring.querySelectorAll('.card3d');
      const vw = Math.min(740, window.innerWidth * 0.92);
      // radius formula: bigger screen -> bigger radius (prevents overlap)
      const radius = Math.max(380, Math.min(520, vw * 0.72));
      cards.forEach(card => {
        const a = Number(card.dataset.baseAngle);
        card.style.transform = `translate(-50%,-50%) rotateY(${a}deg) translateZ(${radius}px)`;
      });
    }

    function render(){
      // smooth ‚Äúdepth‚Äù vibe: slight tilt on ring from velocity
      const tiltX = clamp(-velocity * 0.25, -8, 8);
      ring.style.transform = `rotateX(${tiltX}deg) rotateY(${angle}deg)`;
      // fade cards depending on facing camera
      const cards = ring.querySelectorAll('.card3d');
      cards.forEach(card => {
        const a = Number(card.dataset.baseAngle) + angle;
        // facing factor based on cos
        const rad = (a % 360) * Math.PI/180;
        const face = (Math.cos(rad) + 1) / 2; // 0..1
        const opacity = 0.35 + face * 0.65;
        const blur = (1 - face) * 2.2;
        card.style.opacity = opacity.toFixed(2);
        card.style.filter = `blur(${blur.toFixed(2)}px)`;
        card.style.borderColor = face > 0.85 ? 'rgba(46,230,255,.35)' : 'rgba(255,255,255,.14)';
      });
    }

    function tick(){
      if (!isDown){
        angle += velocity;
        velocity *= 0.94; // friction
        if (Math.abs(velocity) < 0.001) velocity = 0;
      }
      render();
      requestAnimationFrame(tick);
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function rotateToIndex(idx){
      // bring slide idx to front (angle so that baseAngle aligns)
      const target = -idx * step;
      // choose shortest path
      let diff = (target - angle) % 360;
      if (diff > 180) diff -= 360;
      if (diff < -180) diff += 360;
      // kick velocity toward target (nice snap)
      velocity += diff * 0.08;
    }

    function currentIndex(){
      // nearest index to front
      const normalized = ((-angle % 360) + 360) % 360;
      return Math.round(normalized / step) % N;
    }

    function next(){ rotateToIndex((currentIndex() + 1) % N); }
    function prev(){ rotateToIndex((currentIndex() - 1 + N) % N); }

    // Autoplay
    function startAutoplay(){
      stopAutoplay();
      autoplayTimer = setInterval(() => {
        if (!isDown) next();
      }, 2600);
    }
    function stopAutoplay(){
      if (autoplayTimer) clearInterval(autoplayTimer);
      autoplayTimer = null;
    }

    autoplayToggle.addEventListener('change', () => {
      autoplayToggle.checked ? startAutoplay() : stopAutoplay();
    });

    btnNext.addEventListener('click', next);
    btnPrev.addEventListener('click', prev);
    btnRandom.addEventListener('click', () => {
      let r = Math.floor(Math.random() * N);
      if (r === currentIndex()) r = (r + 1) % N;
      rotateToIndex(r);
    });

    // Drag / Swipe
    function down(x){
      isDown = true;
      lastX = x;
      stopAutoplay();
    }
    function move(x){
      if(!isDown) return;
      const dx = x - lastX;
      lastX = x;
      // rotate by drag
      angle += dx * 0.25;
      velocity = dx * 0.10; // inertia injection
    }
    function up(){
      if(!isDown) return;
      isDown = false;
      // gentle snap toward nearest slide
      rotateToIndex(currentIndex());
      if (autoplayToggle.checked) startAutoplay();
    }

    carousel.addEventListener('mousedown', (e)=> down(e.clientX));
    window.addEventListener('mousemove', (e)=> move(e.clientX));
    window.addEventListener('mouseup', up);

    carousel.addEventListener('touchstart', (e)=> down(e.touches[0].clientX), {passive:true});
    carousel.addEventListener('touchmove', (e)=> move(e.touches[0].clientX), {passive:true});
    carousel.addEventListener('touchend', up);

    // Wheel rotate
    carousel.addEventListener('wheel', (e)=>{
      e.preventDefault();
      stopAutoplay();
      const delta = Math.sign(e.deltaY);
      velocity += -delta * 1.25; // wheel "push"
      if (autoplayToggle.checked) startAutoplay();
    }, {passive:false});

    // Keyboard
    window.addEventListener('keydown', (e)=>{
      if (e.key === 'ArrowRight') next();
      if (e.key === 'ArrowLeft') prev();
    });

    // Visibility
    document.addEventListener('visibilitychange', ()=>{
      if (document.hidden) stopAutoplay();
      else if (autoplayToggle.checked) startAutoplay();
    });

    // Build + start
    build();
    render();
    tick();
    startAutoplay();

    window.addEventListener('resize', ()=> { layout(); render(); });

    // Re-apply tilt glow to dynamically created carousel cards
    // (simple: same logic as earlier but only for cards inside ring)
    ring.addEventListener('mousemove', (ev) => {
      const card = ev.target.closest('.card3d');
      if (!card) return;
      const r = card.getBoundingClientRect();
      const x = ev.clientX - r.left;
      const y = ev.clientY - r.top;
      card.style.setProperty('--mx', (x / r.width * 100).toFixed(2) + '%');
      card.style.setProperty('--my', (y / r.height * 100).toFixed(2) + '%');
    });
    ring.addEventListener('mouseleave', () => {
      ring.querySelectorAll('.card3d').forEach(card=>{
        card.style.setProperty('--mx','50%');
        card.style.setProperty('--my','30%');
      });
    });
  </script>
</body>
</html>
